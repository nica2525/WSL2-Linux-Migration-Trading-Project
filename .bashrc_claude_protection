#!/bin/bash
# Claudeå®‰å…¨åˆ¶é™ã‚·ã‚¹ãƒ†ãƒ  v1.0
# ä½œæˆæ—¥: 2025-07-22 22:55 JST
# ç›®çš„: Claudeã®å±é™ºæ“ä½œã‚’åˆ¶é™ã€é‡è¦ãƒ•ã‚¡ã‚¤ãƒ«ä¿è­·

# =============================================================================
# é‡è¦ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿å–ã‚Šå°‚ç”¨ä¿è­·
# =============================================================================

echo "ğŸ›¡ï¸ Claudeå®‰å…¨åˆ¶é™ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•ä¸­..."

# ä¿è­·å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ãƒªã‚¹ãƒˆ
# è‡ªå‹•åŒ–ã‚·ã‚¹ãƒ†ãƒ ã®ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã¯é™¤å¤–ï¼ˆcronæ›¸ãè¾¼ã¿è¨±å¯ï¼‰
PROTECTED_FILES=(
    "CLAUDE.md"
    ".claude/settings.json"
    "Scripts/cron_git_auto_save.py"
    "Scripts/cron_system_monitor.py"
    # ".cron_git_auto_save.log"  # cronæ›¸ãè¾¼ã¿è¨±å¯ã®ãŸã‚ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆ
    # ".cron_monitor.log"         # cronæ›¸ãè¾¼ã¿è¨±å¯ã®ãŸã‚ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆ
)

# ãƒ•ã‚¡ã‚¤ãƒ«ä¿è­·å®Ÿè¡Œ
for file in "${PROTECTED_FILES[@]}"; do
    if [[ -f "$file" ]]; then
        chmod 444 "$file" 2>/dev/null
        echo "âœ… Protected: $file (read-only)"
    fi
done

# =============================================================================
# å±é™ºã‚³ãƒãƒ³ãƒ‰ã®åˆ¶é™
# =============================================================================

# rm ã‚³ãƒãƒ³ãƒ‰åˆ¶é™
alias rm='echo "âš ï¸ [Claude Protection] rm command disabled. Use /bin/rm if absolutely needed."'

# git reset åˆ¶é™
alias git='claude_safe_git'

claude_safe_git() {
    if [[ "$1" == "reset" ]]; then
        echo "âš ï¸ [Claude Protection] git reset disabled. Use /usr/bin/git reset if needed."
        return 1
    else
        /usr/bin/git "$@"
    fi
}

# é‡è¦ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¸ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶é™
alias cd='claude_safe_cd'

claude_safe_cd() {
    local target_dir="$1"

    # å±é™ºãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒªã‚¹ãƒˆ
    local dangerous_dirs=(
        "/home/trader/.claude"
        "/etc"
        "/usr/bin"
        "/bin"
    )

    for danger in "${dangerous_dirs[@]}"; do
        if [[ "$target_dir" == "$danger"* ]]; then
            echo "âš ï¸ [Claude Protection] Access to $danger restricted."
            return 1
        fi
    done

    /bin/cd "$@"
}

echo "âœ… Claudeå®‰å…¨åˆ¶é™ã‚·ã‚¹ãƒ†ãƒ æœ‰åŠ¹åŒ–å®Œäº†"
echo "ğŸ“‹ ä¿è­·çŠ¶æ³:"
echo "   - é‡è¦ãƒ•ã‚¡ã‚¤ãƒ«: èª­ã¿å–ã‚Šå°‚ç”¨"
echo "   - rm ã‚³ãƒãƒ³ãƒ‰: ç„¡åŠ¹åŒ–"
echo "   - git reset: åˆ¶é™"
echo "   - ã‚·ã‚¹ãƒ†ãƒ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª: ã‚¢ã‚¯ã‚»ã‚¹åˆ¶é™"
