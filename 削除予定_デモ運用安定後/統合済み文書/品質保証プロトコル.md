# 🛡️ 品質保証プロトコル - AI記憶欠如対応システム

## 🚨 Claude記憶制限に対する構造的対策

### **前提**: Claudeは会話間で記憶を保持しない
→ 人的記憶に依存しない**システム化された品質保証**が必須

## 📋 必須実行チェックリスト

### **セッション開始時（毎回必須）**
- [ ] `CLAUDE.md`の品質ルール確認
- [ ] 前回の品質問題レビュー（Git履歴確認）
- [ ] 残存する問題ファイルの確認

### **コード実装時（即座実行）**
- [ ] **実装直後テスト**: 動作確認を必ず実行
- [ ] **ランダム要素チェック**: `random.`の使用箇所を全て確認
- [ ] **Look-ahead biasチェック**: `current_bar['close']`使用禁止
- [ ] **実データ使用確認**: 実際の価格データに基づく処理か？

### **重要機能実装後（必須）**
- [ ] **Gemini査読実行**: `mcp__gemini-cli__chat`で品質監査
- [ ] **評価点記録**: 6点未満は即座に修正
- [ ] **問題箇所文書化**: 発見された問題を記録

## 🔧 自動化可能な品質チェック

### **Git Hooks活用**
```bash
# pre-commit hook例
#!/bin/bash
echo "🔍 品質チェック実行中..."

# ランダム要素の危険な使用をチェック
if grep -r "random\.random()" --include="*.py" .; then
    echo "❌ random.random()の使用を検出 - バックテスト偽装の可能性"
    exit 1
fi

# Look-ahead biasチェック
if grep -r "current_bar\['close'\]" --include="*.py" .; then
    echo "❌ Look-ahead bias検出 - current_bar['close']使用禁止"
    exit 1
fi

echo "✅ 基本品質チェック通過"
```

### **定期監査スクリプト**
```bash
#!/bin/bash
# Scripts/quality_audit.sh

echo "📊 定期品質監査実行"

# 問題パターン検索
echo "🔍 既知の問題パターンを検索中..."
grep -r "random\.uniform\|random\.choice" --include="*.py" . | head -10
grep -r "current_bar\['close'\]" --include="*.py" . | head -10

# Gemini査読が必要なファイル検出
echo "🤖 Gemini査読推奨ファイル:"
find . -name "*.py" -newer "$(date -d '1 week ago' +%Y-%m-%d)" -type f
```

## 📝 品質問題記録システム

### **問題発見時の必須記録**
```markdown
## 品質問題レポート - [YYYY-MM-DD]

### 発見された問題
- ファイル: `filename.py:line_number`
- 問題種別: [ランダム生成/Look-ahead bias/その他]
- 重要度: [High/Medium/Low]

### 修正内容
- 修正前: [問題のあったコード]
- 修正後: [修正されたコード]
- Gemini評価: [点数/10]

### 学習ポイント
- この問題を防ぐための今後の対策
```

## 🎯 Claude新セッション時の必須行動

### **1. 品質状況の即座把握**
```bash
# 最新の品質問題を確認
git log --grep="品質\|修正\|Gemini" --oneline -10

# 残存問題ファイルを確認
grep -r "TODO\|FIXME\|random\." --include="*.py" . | head -5
```

### **2. Gemini査読プロトコル**
重要なファイル変更時は**必ずGemini査読**:
```
mcp__gemini-cli__chat "このファイルの品質問題を10点満点で評価してください"
```

### **3. 段階的品質向上**
- 最高優先度: Look-ahead bias除去
- 高優先度: ランダム生成除去
- 中優先度: データ品質向上
- 低優先度: コード効率化

## 🔒 品質保証の強制化

### **Git Pre-commit Hook設定**
```bash
# .git/hooks/pre-commit に品質チェック組込
chmod +x .git/hooks/pre-commit
```

### **CLAUDE.md更新**
品質チェックを**セッション開始時の必須項目**に追加:
```markdown
## 🔍 セッション開始時品質チェック（必須）
1. Git自動保存確認
2. **品質問題レビュー** ← 新規追加
3. Gemini査読対象ファイル確認
```

この**システム化されたアプローチ**により、AIの記憶制限を技術的に克服し、継続的な品質保証を実現できます。
