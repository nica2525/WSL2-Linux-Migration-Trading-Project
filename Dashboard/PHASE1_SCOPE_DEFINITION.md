# Phase 1 スコープ定義 - リアルタイムポジション監視

## 実装期間: 3-5日
## 目標: 動的ダッシュボードの中核価値を最短で実現

---

## 最小限の表示項目（必須）

### ポジション情報テーブル
| 項目 | 表示内容 | 更新頻度 |
|------|----------|----------|
| **通貨ペア** | EURUSD, GBPJPY等 | ポジション変更時 |
| **タイプ** | Buy/Sell | ポジション変更時 |
| **ロット数** | 0.01, 0.10等 | ポジション変更時 |
| **現在損益** | +1,234 JPY | 1秒間隔 |
| **オープン時刻** | 2025-07-28 22:30 | ポジション変更時 |

### 口座サマリー（基本）
| 項目 | 表示内容 | 更新頻度 |
|------|----------|----------|
| **残高** | 3,000,000 JPY | 5秒間隔 |
| **有効証拠金** | 2,987,650 JPY | 5秒間隔 |
| **合計損益** | -12,350 JPY | 1秒間隔 |

---

## 技術アーキテクチャ

### MT5側（データ出力）
- **ファイル形式**: JSON（読みやすさ優先）
- **出力場所**: `/tmp/mt5_data/positions.json`
- **更新トリガー**: ポジション変更時、1秒タイマー
- **必須データ**:
```json
{
  "timestamp": "2025-07-28T22:30:45Z",
  "account": {
    "balance": 3000000,
    "equity": 2987650,
    "profit": -12350
  },
  "positions": [
    {
      "symbol": "EURUSD",
      "type": "buy",
      "volume": 0.01,
      "profit": -1234,
      "open_time": "2025-07-28T22:15:30Z"
    }
  ]
}
```

### Python側（ファイル監視）
- **フレームワーク**: Flask + python-socketio（軽量）
- **ファイル監視**: `watchdog`ライブラリ
- **WebSocket**: シンプルなイベント配信
- **DB**: 使用しない（Phase 1では不要）

### フロントエンド（表示更新）
- **HTML**: シンプルなテーブル構造
- **JavaScript**: WebSocket受信→DOM更新
- **CSS**: 最小限のスタイル（見やすさ重視）

---

## 機能制限（Phase 1では実装しない）

### 削除する複雑機能
- ❌ 統計計算（シャープレシオ等）
- ❌ チャート表示
- ❌ 履歴データ分析
- ❌ アラート機能
- ❌ モバイル対応
- ❌ PWA機能
- ❌ データベース永続化

### 削除する不安定要素
- ❌ Wine連携
- ❌ 直接MT5 API呼び出し
- ❌ マルチスレッド複雑化
- ❌ 外部API連携

---

## 成功基準

### 機能要件
- ✅ ポジション情報がリアルタイム更新される
- ✅ 損益が1秒以内に反映される
- ✅ 新規ポジション・決済が即座に表示される
- ✅ WebSocket接続が安定している

### 非機能要件
- ✅ 24時間連続稼働可能
- ✅ セグメンテーションフォルト発生なし
- ✅ メモリリーク発生なし
- ✅ CPU使用率5%以下

### ユーザー体験
- ✅ ページ読み込み3秒以内
- ✅ データ更新に視覚的フィードバック
- ✅ エラー時の適切なメッセージ表示

---

## Phase 2への移行条件

Phase 1が以下を満たした場合のみPhase 2開発開始：

1. **安定性**: 48時間連続稼働テスト成功
2. **ユーザー承認**: 実際の動作確認・フィードバック
3. **技術的検証**: Gemini再査読で基盤品質承認

---

このスコープに集中することで、最短期間で「動く価値」を提供し、プロジェクトの信頼回復を図ります。