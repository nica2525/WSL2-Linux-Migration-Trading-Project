<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    
    <!-- PWA ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆ - kiroè¨­è¨ˆæº–æ‹  -->
    <link rel="manifest" href="/static/manifest.json">
    <meta name="theme-color" content="#2196F3">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="JamesORB">
    
    <!-- ã‚¢ã‚¤ã‚³ãƒ³ -->
    <link rel="icon" type="image/png" sizes="192x192" href="/static/icons/icon-192x192.png">
    <link rel="apple-touch-icon" href="/static/icons/icon-192x192.png">
    
    <!-- CSS -->
    <link rel="stylesheet" href="/static/css/mobile_dashboard.css?v=2.0">
    <style>
    body {
        background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%) !important;
        color: #ffffff !important;
    }
    .account-label, .position-details, .tab-content h3, .empty-state, 
    .system-info p, .system-info strong, label, .setting-group label,
    #system h3, #system p, #system strong {
        color: #ffffff !important;
    }
    .tab-button {
        color: #64B5F6 !important;
    }
    .tab-button.active {
        color: #2196F3 !important;
        background-color: rgba(33, 150, 243, 0.1) !important;
    }
    
    /* ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ— */
    .info-icon {
        font-size: 12px;
        margin-left: 4px;
        opacity: 0.7;
        cursor: help;
        position: relative;
        display: inline-block;
    }
    
    .info-icon:hover::after {
        content: attr(data-tooltip);
        position: absolute;
        bottom: 100%;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.9);
        color: white;
        padding: 8px 12px;
        border-radius: 6px;
        font-size: 11px;
        white-space: nowrap;
        z-index: 1000;
        pointer-events: none;
        max-width: 200px;
        white-space: normal;
        text-align: left;
        line-height: 1.3;
    }
    
    .info-icon:hover::before {
        content: '';
        position: absolute;
        bottom: 94%;
        left: 50%;
        transform: translateX(-50%);
        border: 4px solid transparent;
        border-top-color: rgba(0, 0, 0, 0.9);
        z-index: 1000;
    }
    </style>
    
    <title>JamesORB ãƒ¢ãƒã‚¤ãƒ«ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script type="module" src="/static/js/app.js?v=2.0"></script>
</head>
<body>
    <div class="app-container">
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <header class="header">
            <div class="header-content">
                <div class="logo">ğŸ“Š JamesORB</div>
                <div class="connection-status">
                    <div class="status-dot" id="connectionStatus"></div>
                    <span id="connectionText">æ¥ç¶šä¸­...</span>
                </div>
            </div>
        </header>
        
        <!-- ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
        <nav class="tab-nav">
            <button class="tab-button active" data-tab="overview">ğŸ“ˆ æ¦‚è¦</button>
            <button class="tab-button" data-tab="positions">ğŸ“‹ ãƒã‚¸ã‚·ãƒ§ãƒ³</button>
            <button class="tab-button" data-tab="market">ğŸ’¹ å¸‚å ´</button>
            <button class="tab-button" data-tab="settings">âš™ï¸ è¨­å®š</button>
        </nav>
        
        <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
        <main class="main-content">
            <!-- PWA ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ä¿ƒé€² -->
            <div class="install-prompt" id="installPrompt" style="display: none;">
                ğŸ“± ãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ã—ã¦ã‚¢ãƒ—ãƒªã®ã‚ˆã†ã«ä½¿ç”¨ã§ãã¾ã™
                <button class="install-btn" onclick="installPWA()">ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</button>
            </div>
            
            <!-- æ¦‚è¦ã‚¿ãƒ– -->
            <div class="tab-content active" id="overview">
                <!-- EAçŠ¶æ…‹ -->
                <div class="card">
                    <div class="ea-status" id="eaStatus">
                        <div class="ea-info">
                            <div class="ea-name">JamesORB v1.0</div>
                            <div class="ea-symbol">EURUSD M5</div>
                        </div>
                        <div class="ea-badge">ç¨¼åƒä¸­</div>
                    </div>
                </div>
                
                <!-- ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ± -->
                <div class="card">
                    <div class="card-title">
                        <span class="icon">ğŸ’°</span>
                        ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±
                    </div>
                    <div class="account-grid">
                        <div class="account-item">
                            <span class="account-value" id="balance">-</span>
                            <div class="account-label">æ®‹é«˜</div>
                        </div>
                        <div class="account-item">
                            <span class="account-value" id="equity">-</span>
                            <div class="account-label">æœ‰åŠ¹è¨¼æ‹ é‡‘</div>
                        </div>
                        <div class="account-item">
                            <span class="account-value" id="profit">-</span>
                            <div class="account-label">å«ã¿æç›Š</div>
                        </div>
                        <div class="account-item">
                            <span class="account-value" id="marginLevel">-</span>
                            <div class="account-label">è¨¼æ‹ é‡‘ç¶­æŒç‡</div>
                        </div>
                    </div>
                </div>
                
                <!-- æœ¬æ—¥ã®çµæœ -->
                <div class="card">
                    <div class="card-title">
                        <span class="icon">ğŸ“Š</span>
                        æœ¬æ—¥ã®çµæœ
                    </div>
                    <div class="account-grid">
                        <div class="account-item">
                            <span class="account-value" id="todayProfit">-</span>
                            <div class="account-label">ä»Šæ—¥ã®åˆ©ç›Š</div>
                        </div>
                        <div class="account-item">
                            <span class="account-value" id="positionCount">-</span>
                            <div class="account-label">ãƒã‚¸ã‚·ãƒ§ãƒ³æ•°</div>
                        </div>
                    </div>
                </div>
                
                <!-- å£åº§æ¨ç§»ãƒãƒ£ãƒ¼ãƒˆ - Phase 2-A -->
                <div class="card">
                    <div class="card-title">
                        <span class="icon">ğŸ“ˆ</span>
                        å£åº§æ¨ç§»ï¼ˆ24æ™‚é–“ï¼‰
                    </div>
                    <div style="position: relative; height: 200px; padding: 10px;">
                        <canvas id="balanceChart"></canvas>
                    </div>
                </div>
                
                <!-- åŸºæœ¬çµ±è¨ˆ - Phase 2-A -->
                <div class="card">
                    <div class="card-title">
                        <span class="icon">ğŸ“‹</span>
                        åŸºæœ¬çµ±è¨ˆ
                    </div>
                    <div class="account-grid">
                        <div class="account-item">
                            <span class="account-value" id="winRate">-</span>
                            <div class="account-label">
                                å‹ç‡
                                <span class="info-icon" data-tooltip="åˆ©ç›Šãƒã‚¸ã‚·ãƒ§ãƒ³æ•° Ã· ç·ãƒã‚¸ã‚·ãƒ§ãƒ³æ•° Ã— 100ã€‚60%ä»¥ä¸ŠãŒè‰¯å¥½ã¨ã•ã‚Œã¾ã™ã€‚">â„¹ï¸</span>
                            </div>
                        </div>
                        <div class="account-item">
                            <span class="account-value" id="profitFactor">-</span>
                            <div class="account-label">
                                ãƒ—ãƒ­ãƒ•ã‚£ãƒƒãƒˆãƒ•ã‚¡ã‚¯ã‚¿ãƒ¼
                                <span class="info-icon" data-tooltip="ç·åˆ©ç›Š Ã· ç·æå¤±ã€‚1.0ä»¥ä¸Šã§åˆ©ç›Šã€1.5ä»¥ä¸ŠãŒç†æƒ³çš„ã§ã™ã€‚">â„¹ï¸</span>
                            </div>
                        </div>
                        <div class="account-item">
                            <span class="account-value" id="maxDrawdown">-</span>
                            <div class="account-label">
                                æœ€å¤§ãƒ‰ãƒ­ãƒ¼ãƒ€ã‚¦ãƒ³
                                <span class="info-icon" data-tooltip="å£åº§æ®‹é«˜ã®æœ€å¤§ä¸‹è½ç‡ã€‚10%ä»¥ä¸‹ãŒè‰¯å¥½ã€25%è¶…ã¯å±é™ºã§ã™ã€‚">â„¹ï¸</span>
                            </div>
                        </div>
                        <div class="account-item">
                            <span class="account-value" id="totalTrades">-</span>
                            <div class="account-label">
                                ç·å–å¼•æ•°
                                <span class="info-icon" data-tooltip="ç¾åœ¨ä¿æœ‰ä¸­ã®ãƒã‚¸ã‚·ãƒ§ãƒ³æ•°ã€‚ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç°¡æ˜“çµ±è¨ˆã§ã™ã€‚">â„¹ï¸</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ãƒã‚¸ã‚·ãƒ§ãƒ³ã‚¿ãƒ– -->
            <div class="tab-content" id="positions">
                <div class="card">
                    <div class="card-title">
                        <span class="icon">ğŸ“‹</span>
                        ç¾åœ¨ã®ãƒã‚¸ã‚·ãƒ§ãƒ³
                    </div>
                    <div id="positionsList">
                        <div class="loading">
                            <div class="spinner"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- å¸‚å ´ã‚¿ãƒ– -->
            <div class="tab-content" id="market">
                <div class="card">
                    <div class="card-title">
                        <span class="icon">ğŸ’¹</span>
                        å¸‚å ´ãƒ‡ãƒ¼ã‚¿
                    </div>
                    <div class="market-price" id="marketData">
                        <div class="price-info">
                            <div class="symbol-name">EURUSD</div>
                            <div class="price-time" id="priceTime">-</div>
                        </div>
                        <div class="price-values">
                            <div class="bid-ask">
                                <span id="bid">-</span> / <span id="ask">-</span>
                            </div>
                            <div class="spread">ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰: <span id="spread">-</span> pips</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- è¨­å®šã‚¿ãƒ– -->
            <div class="tab-content" id="settings">
                <div class="card">
                    <div class="card-title">
                        <span class="icon">âš™ï¸</span>
                        ã‚¢ãƒ—ãƒªè¨­å®š
                    </div>
                    <div style="padding: 12px 0;">
                        <label style="display: block; margin-bottom: 12px; font-size: 14px;">
                            <input type="checkbox" id="autoRefresh" checked style="margin-right: 8px;">
                            è‡ªå‹•æ›´æ–° (5ç§’é–“éš”)
                        </label>
                        <label style="display: block; margin-bottom: 12px; font-size: 14px;">
                            <input type="checkbox" id="soundNotification" style="margin-right: 8px;">
                            éŸ³å£°é€šçŸ¥
                        </label>
                        <label style="display: block; margin-bottom: 12px; font-size: 14px;">
                            <input type="checkbox" id="vibrationNotification" checked style="margin-right: 8px;">
                            ãƒã‚¤ãƒ–ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é€šçŸ¥
                        </label>
                        <button id="clearCacheBtn" style="width: 100%; padding: 12px; background: #FF9800; color: white; border: none; border-radius: 8px; font-size: 14px; margin-top: 12px;">
                            ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢
                        </button>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-title">
                        <span class="icon">ğŸš¨</span>
                        ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®š
                        <button id="toggleAlertSettings" style="float: right; background: #2196F3; color: white; border: none; border-radius: 4px; padding: 4px 8px; font-size: 12px;">
                            è¨­å®š
                        </button>
                    </div>
                    <div id="alertSettingsContainer" style="display: none; padding: 12px 0;">
                        <div class="setting-group" style="margin-bottom: 16px;">
                            <h5 style="margin: 0 0 8px 0; font-size: 13px; color: #666;">è¨¼æ‹ é‡‘ç¶­æŒç‡</h5>
                            <div style="display: flex; gap: 8px; margin-bottom: 8px;">
                                <div style="flex: 1;">
                                    <label style="font-size: 12px; color: #888;">å±é™ºãƒ¬ãƒ™ãƒ«</label>
                                    <input type="number" id="marginCritical" style="width: 100%; padding: 4px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px;" placeholder="150">
                                    <span style="font-size: 11px; color: #999;">%</span>
                                </div>
                                <div style="flex: 1;">
                                    <label style="font-size: 12px; color: #888;">è­¦å‘Šãƒ¬ãƒ™ãƒ«</label>
                                    <input type="number" id="marginWarning" style="width: 100%; padding: 4px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px;" placeholder="300">
                                    <span style="font-size: 11px; color: #999;">%</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="setting-group" style="margin-bottom: 16px;">
                            <h5 style="margin: 0 0 8px 0; font-size: 13px; color: #666;">ãƒ‰ãƒ­ãƒ¼ãƒ€ã‚¦ãƒ³</h5>
                            <div style="display: flex; gap: 8px; margin-bottom: 8px;">
                                <div style="flex: 1;">
                                    <label style="font-size: 12px; color: #888;">å±é™ºãƒ¬ãƒ™ãƒ«</label>
                                    <input type="number" id="ddCritical" style="width: 100%; padding: 4px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px;" placeholder="25">
                                    <span style="font-size: 11px; color: #999;">%</span>
                                </div>
                                <div style="flex: 1;">
                                    <label style="font-size: 12px; color: #888;">è­¦å‘Šãƒ¬ãƒ™ãƒ«</label>
                                    <input type="number" id="ddWarning" style="width: 100%; padding: 4px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px;" placeholder="15">
                                    <span style="font-size: 11px; color: #999;">%</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="setting-group" style="margin-bottom: 16px;">
                            <h5 style="margin: 0 0 8px 0; font-size: 13px; color: #666;">ãƒã‚¸ã‚·ãƒ§ãƒ³æå¤±</h5>
                            <div style="display: flex; gap: 8px; margin-bottom: 8px;">
                                <div style="flex: 1;">
                                    <label style="font-size: 12px; color: #888;">å±é™ºãƒ¬ãƒ™ãƒ«</label>
                                    <input type="number" id="lossCritical" style="width: 100%; padding: 4px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px;" placeholder="-50000">
                                    <span style="font-size: 11px; color: #999;">å††</span>
                                </div>
                                <div style="flex: 1;">
                                    <label style="font-size: 12px; color: #888;">è­¦å‘Šãƒ¬ãƒ™ãƒ«</label>
                                    <input type="number" id="lossWarning" style="width: 100%; padding: 4px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px;" placeholder="-20000">
                                    <span style="font-size: 11px; color: #999;">å††</span>
                                </div>
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 8px;">
                            <button id="saveAlertSettings" style="flex: 1; padding: 8px; background: #4CAF50; color: white; border: none; border-radius: 4px; font-size: 12px;">
                                è¨­å®šã‚’ä¿å­˜
                            </button>
                            <button id="resetAlertSettings" style="flex: 1; padding: 8px; background: #9E9E9E; color: white; border: none; border-radius: 4px; font-size: 12px;">
                                ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã™
                            </button>
                        </div>
                        
                        <div style="margin-top: 12px; padding: 8px; background: #f5f5f5; border-radius: 4px; font-size: 11px; color: #666;">
                            ğŸ’¡ ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®šã¯å³åº§ã«åæ˜ ã•ã‚Œã¾ã™ã€‚ãƒªã‚¹ã‚¯è¨±å®¹åº¦ã«å¿œã˜ã¦èª¿æ•´ã—ã¦ãã ã•ã„ã€‚
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-title">
                        <span class="icon">â„¹ï¸</span>
                        ã‚¢ãƒ—ãƒªæƒ…å ±
                    </div>
                    <div style="padding: 12px 0; font-size: 12px; color: #666; line-height: 1.6;">
                        <div>ãƒãƒ¼ã‚¸ãƒ§ãƒ³: 1.0.0</div>
                        <div>æœ€çµ‚æ›´æ–°: <span id="lastUpdate">-</span></div>
                        <div>æ¥ç¶šçŠ¶æ…‹: <span id="connectionInfo">ç¢ºèªä¸­...</span></div>
                        <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid #f0f0f0;">
                            kiroè¨­è¨ˆã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æº–æ‹ <br>
                            Tailscale VPN + Basicèªè¨¼
                        </div>
                    </div>
                </div>
            </div>
        </main>
        
        <!-- ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒœã‚¿ãƒ³ -->
        <button class="refresh-btn" id="refreshBtn" onclick="refreshData()">
            ğŸ”„
        </button>
        
        <!-- é€šçŸ¥ - GeminiæŸ»èª­å¯¾å¿œæ”¹å–„ -->
        <div class="notification" id="notification"></div>
    </div>
</body>
</html>