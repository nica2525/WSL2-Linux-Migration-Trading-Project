# Phase 1: アーキテクチャ設計依頼

## 設計対象
**JamesORBデモ取引監視ダッシュボード - システムアーキテクチャ設計**

### プロジェクト背景
- 現在JamesORB EAがMT5デモ口座で稼働中（300万円、EURUSD）
- 外出先からスマホでEA稼働状況・ポジション・損益を監視したい
- 月額コスト0円での運用が必須条件
- セキュリティを保ちつつ実用的なシステムが必要

## 技術的制約
### 現在の環境
- **MT5環境**: Wine上で動作（Ubuntu WSL）
- **Python**: 3.x系（MetaTrader5パッケージ利用可能）
- **ネットワーク**: Tailscale VPN利用予定（完全無料・時間制限なし）
- **開発環境**: VS Code + Claude Code

### 既存ライブラリ・実装済み
- **バックエンド**: Flask + Flask-SocketIO（基本実装済み）
- **フロントエンド**: HTML + JavaScript + Chart.js（テンプレート作成済み）
- **MT5接続**: MetaTrader5 Pythonパッケージ（Wine環境で動作確認済み）
- **共通ライブラリ**: config_manager, logger_setup, error_handler実装済み

### パフォーマンス要件
- **更新頻度**: リアルタイム性重視（1-5秒程度の遅延は許容）
- **同時接続数**: 1-3台程度（個人利用）
- **データ量**: ポジション数最大10件、価格データ履歴50点程度
- **レスポンス**: モバイル3G/4G環境でも実用的な速度

## 設計依頼内容

### 1. MT5接続方式の技術選定
以下の選択肢から最適な方式を選定し、理由を説明してください：

**A. 標準MT5 Python API（MetaTrader5パッケージ）**
- 現在の実装で使用中
- Wine環境での動作実績あり
- 無料・追加コストなし

**B. PyTrader（WebSocket橋渡し）**
- MT5 ⟷ Python間のWebSocket通信
- より安定した接続の可能性
- 実装複雑度は上昇

**C. MetaApi（クラウドサービス）**
- プロ級のWebSocket API
- 月額課金の可能性（要確認）
- 最も安定・高機能

**選定時の考慮事項**:
- Wine環境での安定性
- 実装・保守の容易さ
- 将来的な拡張性
- コスト（無料が必須）

### 2. WebSocket vs REST API設計
リアルタイムデータ配信の実装方式を設計してください：

**WebSocket方式（現在の実装）**
- Flask-SocketIOで実装済み
- リアルタイム双方向通信
- 接続維持のオーバーヘッド

**REST + ポーリング方式**
- シンプルな実装
- クライアント側で更新間隔制御
- サーバー負荷は低い

**ハイブリッド方式**
- 基本情報はREST
- リアルタイムデータはWebSocket
- 用途別の最適化

**設計項目**:
- データ更新頻度とレイテンシのバランス
- モバイル回線での接続安定性
- バッテリー消費への配慮
- 実装複雑度とメンテナンス性

### 3. セキュリティ基本方針
Tailscale VPN前提でのセキュリティ設計：

**認証方式の選定**
- Basic認証（シンプル・Tailscale併用で十分？）
- JWT Token（将来の拡張性）
- 認証なし（VPNのみに依存）

**データ保護**
- VPN暗号化で十分か
- アプリケーション層での追加暗号化要否
- ログ・データの保存方針

**アクセス制御**
- IPアドレス制限の必要性
- デバイス認証の実装要否
- セッション管理方針

## 期待する成果物

### 1. システム構成図
- 全体アーキテクチャの図解
- データフローの明示
- 各コンポーネントの役割

### 2. 技術選定理由書
- 各選択の根拠説明
- 代替案との比較
- リスクと対策

### 3. 実装優先順位
- MVP機能の定義
- 段階的実装計画
- 各段階の完了基準

## 参考情報

### 調査済み実装例
1. **mt5_flask** - Python Flask + WebSocket統合
2. **Real-Time Stock Dashboard** - Chart.jsリアルタイム更新
3. **MetaApi WebSocket** - プロ級実装例

### 現在の実装状況
- `Dashboard/app.py` - Flask + SocketIO基本実装
- `Dashboard/templates/dashboard.html` - デスクトップUI
- `Dashboard/templates/mobile_dashboard.html` - モバイルUI

### 制約事項まとめ
- 月額コスト0円必須
- Wine環境での動作必須
- モバイルファースト設計
- 個人利用規模（スケーラビリティ不要）

---

**依頼者**: Claude（実装担当）
**期待納期**: 実装開始前の設計完了希望
**質問対応**: 不明点は随時確認可能