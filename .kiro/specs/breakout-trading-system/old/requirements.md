# 要件定義書

**作成日時**: 2025年7月18日 07:18 JST  
**作成者**: Kiro AI IDE  
**プロジェクト**: ブレイクアウト手法実運用システム統合プロジェクト

## はじめに

本プロジェクトは、Gemini満点評価(5.0/5.0)を獲得したPython WFAシステムを基盤として、実際の取引実行が可能な統合システムを構築することを目的とする。既存の並列処理最適化(19倍高速化・0.58秒実行)とスリッパージ統合機能を維持しながら、MT4との連携による実取引フローを実現する。

## 要件

### 要件1

**ユーザーストーリー:** トレーダーとして、WFA最適化パラメータに基づいてブレイクアウト取引を自動実行したい。手動介入なしに体系的な取引の恩恵を受けるため。

#### 受入基準

1. WFA最適化が完了した時、システムは5秒以内にMT4 EAパラメータを自動更新すること
2. ブレイクアウトシグナルが生成された時、システムはシグナル検出から100ms以内に取引を実行すること
3. 市場状況が変化した時、システムは50ms以内に現在のボラティリティに基づいてポジションサイズを調整すること
4. PythonとMT4間の通信が失敗した場合、システムは最大3回まで自動再接続を試行すること
5. 取引が実行された時、システムはスリッパージと実際の約定価格を含む全実行詳細をログに記録すること

### 要件2

**ユーザーストーリー:** トレーダーとして、システムの健全性と取引パフォーマンスをリアルタイムで監視したい。システムが安全かつ収益性を持って動作することを確保するため。

#### 受入基準

1. システムが開始された時、30秒以内に全コンポーネントの包括的ヘルスチェックを実行すること
2. システム可用性が99%を下回った時、即座にアラートを送信し復旧手順を開始すること
3. ドローダウンが事前定義された限界を超えた時、システムは自動的に取引を停止し手動介入を要求すること
4. 任意のコンポーネントが失敗した場合、システムは障害を分離し残りのコンポーネントで動作を継続すること
5. 取引セッションが終了した時、60秒以内に包括的パフォーマンスレポートを生成すること

### 要件3

**ユーザーストーリー:** トレーダーとして、Python WFA最適化とMT4実行間のシームレスな統合を望む。両プラットフォームの最良の部分を活用するため。

#### 受入基準

1. Pythonが取引シグナルを生成した時、MT4は50ms以内にそれを受信し処理すること
2. MT4が取引を実行した時、Pythonは100ms以内に確認を受信しポジション追跡を更新すること
3. WSL2-Windows通信が失敗した場合、システムは自動的にファイルベース通信にフォールバックすること
4. パラメータ更新が必要な時、システムはサービス中断なしに全コンポーネントを同期すること
5. システムが再起動した時、全コンポーネントは2分以内に前の状態を復元すること

### 要件4

**ユーザーストーリー:** トレーダーとして、堅牢なリスク管理とポジション制御を望む。予期しない市場イベントから資本を保護するため。

#### 受入基準

1. ポジションサイズ計算が必要な時、システムは現在の口座残高、ボラティリティ、リスクパラメータを考慮すること
2. 最大日次損失限界に達した時、システムは即座に全ポジションを決済し取引を停止すること
3. 市場ボラティリティが通常範囲を超えた場合、システムはポジションサイズを50%削減すること
4. ネットワーク接続が失われた時、システムは全オープンポジションの保護ストップを維持すること
5. 緊急シャットダウンが発動された時、全ポジションは30秒以内に決済されること

### 要件5

**ユーザーストーリー:** トレーダーとして、包括的なデータ永続化と復旧機能を望む。再起動と障害を通じてシステム継続性を維持するため。

#### 受入基準

1. WFA最適化結果が生成された時、5秒以内にSQLiteデータベースに永続化されること
2. システム状態が変化した時、スナップショットが毎時自動保存されること
3. システムがクラッシュした場合、再起動から3分以内に最後の正常状態に復旧すること
4. データ破損が検出された時、システムは自動的に最新の有効バックアップから復元すること
5. 履歴データが要求された時、システムは最低6ヶ月の取引履歴へのアクセスを提供すること

### 要件6

**ユーザーストーリー:** トレーダーとして、システムが既存の自動化インフラとの互換性を維持することを望む。現在の運用設定を保持するため。

#### 受入基準

1. 新システムが展開された時、既存のcron自動化は変更なしに機能し続けること
2. システムが動作する時、現在の19ワーカー並列処理性能を維持すること
3. 既存のGemini 5.0/5.0評価コンポーネントが使用される場合、その機能は変更されないこと
4. システムが実行される時、09:00-22:00の運用時間窓を遵守し自動シャットダウンすること
5. メンテナンスが必要な時、システムは個別コンポーネントのホットスワップをサポートすること