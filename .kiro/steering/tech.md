# 技術仕様書

**作成日時**: 2025年7月18日 07:31 JST  
**作成者**: Kiro AI IDE  
**プロジェクト**: ブレイクアウト手法実運用システム統合プロジェクト

## 技術スタック選択理由

### Python-MT4技術スタック

#### Python選択理由
- **既存資産活用**: Gemini満点WFAシステムがPythonで実装済み
- **データ処理能力**: pandas, numpy による高速数値計算
- **並列処理**: multiprocessing による19ワーカー並列実行実績
- **開発効率**: 豊富なライブラリエコシステムと開発速度
- **保守性**: 可読性の高いコードによる長期保守容易性

#### MT4選択理由
- **市場標準**: 個人トレーダーの標準プラットフォーム
- **ブローカー対応**: 多数のブローカーでサポート
- **実績**: 長期間の安定稼働実績
- **バックテスト機能**: 戦略検証機能の充実
- **コミュニティ**: 豊富な情報とサポート

#### WSL2環境選択理由
- **開発効率**: Linux環境でのPython開発の利便性
- **互換性**: Windows MT4との共存可能
- **パフォーマンス**: ネイティブLinux並みの実行速度
- **ツール**: 豊富なLinux開発ツールの利用可能

## アーキテクチャ決定事項

### 通信アーキテクチャ

#### 複数通信方式採用決定
**決定**: TCP Socket + File-based + Named Pipe の3方式実装
**理由**: 
- WSL2-Windows間通信の不安定性リスク軽減
- 単一障害点の排除
- 環境依存問題への対応
- フェイルオーバー機能による高可用性確保

#### TCP Socket主要方式決定
**決定**: TCP Socketを主要通信方式として採用
**理由**:
- 低レイテンシ（<50ms要件）の実現可能性
- 双方向通信による確認応答機能
- 接続状態監視によるリアルタイム健全性確認
- 業界標準プロトコルによる互換性

#### File-based フォールバック決定
**決定**: ファイルベース通信をフォールバック方式として採用
**理由**:
- 最も確実な通信方式（ファイルシステム依存）
- プラットフォーム間互換性の保証
- デバッグ時の可視性
- 緊急時の手動介入可能性

### データ永続化アーキテクチャ

#### SQLite拡張決定
**決定**: 既存SQLiteデータベースの拡張による実装
**理由**:
- 既存システムとの整合性維持
- 軽量で高速なローカルデータベース
- トランザクション機能による整合性保証
- バックアップ・復旧の簡便性
- 外部依存関係の最小化

#### スナップショット方式採用
**決定**: 毎時自動スナップショット + 差分バックアップ
**理由**:
- 高速復旧の実現
- ストレージ効率の最適化
- 複数時点への復旧可能性
- 自動化による運用負荷軽減

### 並列処理アーキテクチャ

#### 既存並列処理保持決定
**決定**: 現在の19ワーカー並列処理アーキテクチャを保持
**理由**:
- 実証済みパフォーマンス（0.58秒実行）
- Gemini満点システムの変更リスク回避
- CPU使用率最適化済み
- 安定性実績

## パフォーマンス方針

### レイテンシ最適化方針

#### 通信レイテンシ目標
- **目標値**: 50ms以下
- **測定方法**: シグナル生成から MT4 受信までの時間
- **最適化手法**: 
  - 接続プール使用による接続オーバーヘッド削減
  - メッセージ圧縮による転送時間短縮
  - 非同期処理による並列実行

#### 処理レイテンシ目標
- **目標値**: 100ms以下（シグナル検出から取引実行まで）
- **測定方法**: エンドツーエンド処理時間
- **最適化手法**:
  - インメモリデータ処理
  - 事前計算による処理時間短縮
  - キャッシュ機構による重複計算回避

### スループット最適化方針

#### シグナル処理能力
- **目標値**: 100シグナル/分以上
- **測定方法**: 高頻度シグナル生成時の処理能力
- **最適化手法**:
  - バッチ処理による効率化
  - 優先度キューによる重要シグナル優先処理
  - 並列処理による処理能力向上

### リソース使用最適化方針

#### メモリ使用最適化
- **方針**: 最大使用メモリ量の制限と効率的利用
- **手法**:
  - メモリプール使用による断片化防止
  - 不要データの定期的クリーンアップ
  - 大容量データのストリーミング処理

#### CPU使用最適化
- **方針**: CPU使用率の平準化と効率的利用
- **手法**:
  - CPUアフィニティ設定による最適化
  - 重要プロセスの優先度調整
  - アイドル時間の有効活用

## セキュリティ方針

### 通信セキュリティ

#### ローカル通信限定方針
**方針**: 全通信をローカルネットワーク内に限定
**実装**:
- TCP Socket: localhost バインドのみ
- File-based: ローカルファイルシステムのみ
- Named Pipe: ローカルプロセス間通信のみ

#### メッセージ整合性検証
**方針**: 全メッセージの整合性検証実施
**実装**:
- チェックサム検証による改ざん検出
- メッセージ順序番号による欠損検出
- タイムスタンプによる古いメッセージ排除

### データ保護

#### 機密データ暗号化
**方針**: 取引関連機密データの暗号化保存
**実装**:
- データベース暗号化（SQLite暗号化拡張）
- 設定ファイル暗号化
- ログファイル機密情報マスキング

#### アクセス制御
**方針**: 最小権限原則によるアクセス制御
**実装**:
- ファイル権限の厳格設定
- プロセス分離による権限制限
- 監査ログによる操作追跡

### 運用セキュリティ

#### 異常検知
**方針**: セキュリティ異常の自動検知と対応
**実装**:
- 異常アクセスパターン検知
- リソース使用量異常監視
- 通信パターン異常検知

#### インシデント対応
**方針**: セキュリティインシデントへの迅速対応
**実装**:
- 自動緊急停止機能
- インシデントログ自動収集
- 復旧手順の自動化