# コスト反映後 WFA 結果サマリーとClaudeCodeへの指導

## 1. コスト反映後 WFA 結果

- **前提条件**
  - スプレッド：1.5 pips
  - 約定手数料：0.3 pips
  - 1 pip = 0.0001、1ロット＝100,000通貨単位

| Fold | OOS リターン | トレード数 | 生 PnL (円) | 総コスト (円) | 純 PnL (円) | 純リターン |
|------|-------------:|-----------:|-----------:|------------:|------------:|-----------:|
| 1    |     0.0478   |     44     |       4,780|        792  |      3,988 | 0.0399    |
| 2    |     0.0160   |     45     |       1,600|        810  |        790 | 0.0079    |
| 3    |     0.0137   |     45     |       1,370|        810  |        560 | 0.0056    |
| 4    |     0.0511   |     88     |       5,110|      1,584  |      3,526 | 0.0353    |
| 5    |     0.0570   |     45     |       5,700|        810  |      4,890 | 0.0489    |

- **平均 OOS リターン（生）**：≈ 0.0373  
- **平均 純リターン（コスト後）**：≈ 0.0275  

## 2. 考察

1. 各フォールドで純リターンが 20–50% 程度減少。
2. Fold 2・3 はコスト影響が大きく、純リターンが 0.008–0.006 と低水準。
3. Fold 1・4・5 は実用水準（純リターン ≥ 0.03, PF ≥ 1.3）を維持。

## 3. ClaudeCode への論理的指導

- **MCP パイプライン調整**  
  - コストモデル適用ステップを `_analyze_wfa_results` 前に挿入し、全結果に統一的に反映させる。  
  - `apply_transaction_costs` 用のパラメータ (`spread_pips`, `commission_pips`) を `base_params` に追加し、MCP設定から変更可能にする。

- **感度分析自動化**  
  - スプレッド・手数料を複数パターンで走らせるループを追加し、PFと純リターンの変動レポートを自動生成させる。  
  - MCPタスクとして、`sensitivity_analysis.mcp.yaml` を作成し、出力をダッシュボードに表示。

- **ドローダウン再評価統合**  
  - コスト後 equity curve を生成し、`compute_drawdown` ロジックを呼び出して最大ドローダウンを算出。  
  - 併せて許容ドローダウン（例：10%）を超えたフォールドをアラートし、フィルター強化候補を報告させる。

- **レポート形式出力**  
  - Markdown レポート (`wfa_cost_analysis.md`) を生成し、Git リポジトリ `reports/` 以下に保存。  
  - ClaudeCode CLI フックとして、タスク実行後に自動でコミット＆プッシュする設定を検討。

---

*この Markdown ファイルを参照し、次の ClaudeCode MCP タスクに組み込んでください。*
