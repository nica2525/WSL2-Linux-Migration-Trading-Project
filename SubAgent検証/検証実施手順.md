# Sub-Agentフリーズ境界線検証実施手順

## 🎯 検証の目的
Sub-Agent機能の安定動作境界を特定し、実用的な使用ガイドラインを確立する

## 📋 事前準備チェックリスト
- [ ] WSL2環境の再起動（クリーンな状態確保）
- [ ] 他の重いプロセスの停止
- [ ] システムモニタリングツールの準備（htop推奨）
- [ ] テストファイルの生成確認
- [ ] リカバリー手順の確認

## 🔬 検証実施手順

### 1. 環境準備
```bash
# ディレクトリ移動
cd ~/Trading-Development/2.ブレイクアウト手法プロジェクト/SubAgent検証

# テストファイル確認
ls -la test_files/*/*.py | wc -l
# 期待値: 35ファイル程度

# システム状態確認
free -h
ps aux | grep -E "claude|node" | grep -v grep
```

### 2. モニタリング開始
別ターミナルで以下を実行:
```bash
# リアルタイムモニタリング
watch -n 1 'ps aux | grep -E "claude|node" | grep -v grep'

# または htop でCPU/メモリ監視
htop
```

### 3. 段階的検証実行

#### フェーズ1: 安全領域確認（推奨開始）
```bash
# 検証スクリプト実行
./run_test.sh

# T001から順番に実行
# 各テスト後に以下を確認:
# - 実行時間
# - CPU使用率ピーク
# - メモリ使用量
# - エラーの有無
```

#### フェーズ2: 境界探索
- T003（中規模ファイル）で遅延を確認
- 30秒以上かかる場合は要注意
- フリーズ兆候があれば即座に中断

#### フェーズ3: 危険領域確認（オプション）
- T004（大規模ファイル）は高リスク
- 実行前に必ずリカバリー準備
- フリーズ覚悟で実行

### 4. 実際のSub-Agent呼び出し方法

#### 方法A: CLIから直接実行
```bash
# 基本形式
claude --agent "タスクの説明"

# 例: 小規模ファイル読取
claude --agent "test_files/minimal/tiny.pyの内容を確認してください"
```

#### 方法B: Task toolを使用（Claude内から）
```python
# Claude内で実行
Task(
    description="ファイル分析",
    prompt="test_files/small/small_simple.pyの構造を分析",
    subagent_type="general-purpose"
)
```

### 5. 検証結果の記録

#### 手動記録フォーマット
```yaml
test_id: "T001"
timestamp: "2025-07-31 10:30:00"
parameters:
  file_size: "0.1KB"
  file_count: 1
  complexity: "simple"
result:
  status: "success"  # success/warning/freeze/error
  execution_time: "3秒"
  cpu_peak: "45%"
  memory_usage: "250MB"
observations: |
  - スムーズに実行完了
  - レスポンス遅延なし
  - プロセス正常終了
```

### 6. フリーズ時の対処

#### 段階的リカバリー
1. **30秒待機** - 処理中の可能性
2. **Ctrl+C** - 優しい中断
3. **別ターミナルから確認**:
   ```bash
   ps aux | grep -E "claude|node"
   # プロセスIDを特定
   ```
4. **プロセス終了**:
   ```bash
   pkill -f "node.*claude"
   # または
   kill -9 [プロセスID]
   ```
5. **WSL再起動**（最終手段）:
   ```bash
   # PowerShellから
   wsl --shutdown
   wsl
   ```

## 📊 結果分析

### 境界線判定基準
| 指標 | 安全 | 注意 | 危険 |
|------|------|------|------|
| 実行時間 | <10秒 | 10-30秒 | >30秒 |
| ファイルサイズ | <10KB | 10-100KB | >100KB |
| ファイル数 | 1-5 | 5-20 | >20 |
| CPU使用率 | <50% | 50-80% | >80% |

### レポート生成
```bash
# 分析ツール実行
python3 analyze_results.py

# レポート確認
cat boundary_analysis_report.md
```

## 🎯 最終目標

### 実用的ガイドライン策定
1. **推奨使用条件の明確化**
   - 確実に動作する条件範囲
   - パフォーマンス期待値

2. **リスク評価基準**
   - 各パラメータの危険閾値
   - 組み合わせリスクマトリクス

3. **最適化戦略**
   - 効果的なタスク分割方法
   - コンテキスト削減テクニック

## ⚠️ 重要な注意事項

1. **検証は段階的に実施**
   - 急激な負荷増加を避ける
   - 各段階で安定性確認

2. **バックアップの確保**
   - 重要作業前の状態保存
   - Git commitの活用

3. **時間帯の考慮**
   - システムリソースが十分な時に実施
   - 他の作業への影響を最小化

## 📚 検証後のアクション

1. **結果の文書化**
   - セッション記録への追記
   - 境界線マトリクスの更新

2. **運用ルール策定**
   - チーム内での使用基準
   - 緊急時対応手順

3. **継続的改善**
   - Claude Codeアップデート後の再検証
   - 新しい使用パターンの発見
