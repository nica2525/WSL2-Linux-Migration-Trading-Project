# Phase 2 要件定義書 - リアルタイムシグナル生成システム

**作成日時**: 2025-07-18  
**フェーズ**: Phase 2 - Real-time Signal Generator  
**前提条件**: Phase 1通信インフラ完了（A+評価）  

## 🎯 Phase 2目標

### 主要目標
**リアルタイムシグナル生成システム構築**
- 市場データリアルタイム取得・監視
- WFA最適パラメータ適用・ブレイクアウト判定
- 取引シグナル生成・MT4送信
- スリッパージ・執行遅延考慮

### 成功基準
- リアルタイム価格処理 <100ms
- WFA最適化精度維持
- Phase 1通信インフラとの完全統合
- 信頼性の高いシグナル生成

## 📋 機能要件

### FR-2.1 リアルタイムデータ取得システム
**要件ID**: FR-2.1  
**優先度**: 高  

#### FR-2.1.1 価格データストリーミング
- **機能**: MT4から価格データをリアルタイム取得
- **入力**: 通貨ペア指定、取得間隔設定
- **出力**: リアルタイム価格データ（OHLC、timestamp）
- **制約**: 遅延 <50ms、データ欠損時の補完機能

#### FR-2.1.2 データ品質管理
- **機能**: 取得データの品質検証・異常値検出
- **入力**: 生価格データ
- **出力**: 品質フラグ付きデータ、異常アラート
- **制約**: スパイクデータ、データ欠損の自動識別

### FR-2.2 シグナル生成エンジン
**要件ID**: FR-2.2  
**優先度**: 高  

#### FR-2.2.1 ブレイクアウト判定
- **機能**: WFA最適パラメータによるブレイクアウト判定
- **入力**: リアルタイム価格、最適lookbackパラメータ
- **出力**: ブレイクアウトシグナル（BUY/SELL/NONE）
- **制約**: WFA最適化結果の精度維持

#### FR-2.2.2 シグナル品質評価
- **機能**: 生成シグナルの信頼度・品質評価
- **入力**: 生成シグナル、市場状況データ
- **出力**: 信頼度スコア、推奨ポジションサイズ
- **制約**: 信頼度スコア 0.0-1.0、最小閾値設定可能

### FR-2.3 WFA統合システム
**要件ID**: FR-2.3  
**優先度**: 高  

#### FR-2.3.1 最適パラメータ適用
- **機能**: WFA最適化結果の自動適用
- **入力**: WFA最適化結果ファイル
- **出力**: 適用済みパラメータ、適用状況
- **制約**: パラメータ変更時の無停止更新

#### FR-2.3.2 パフォーマンス監視
- **機能**: 実運用パフォーマンス vs WFA予測の比較
- **入力**: 実取引結果、WFA予測結果
- **出力**: パフォーマンス分析レポート
- **制約**: 日次、週次、月次レポート自動生成

### FR-2.4 スリッパージ統合
**要件ID**: FR-2.4  
**優先度**: 中  

#### FR-2.4.1 動的スリッパージ調整
- **機能**: 市場状況に応じたスリッパージ調整
- **入力**: 市場ボラティリティ、スプレッド情報
- **出力**: 調整済みスリッパージ予測値
- **制約**: 既存advanced_slippage_modelとの統合

#### FR-2.4.2 執行遅延補正
- **機能**: シグナル生成から約定までの遅延補正
- **入力**: 生成シグナル、通信遅延測定値
- **出力**: 遅延補正済みシグナル
- **制約**: 遅延測定・補正の自動化

## 🔧 非機能要件

### NFR-2.1 性能要件
**要件ID**: NFR-2.1  

#### NFR-2.1.1 応答時間
- **リアルタイム処理**: <100ms（価格取得→シグナル生成）
- **シグナル生成**: <50ms（判定ロジック実行）
- **データ品質チェック**: <10ms（異常値検出）

#### NFR-2.1.2 スループット
- **価格データ処理**: 毎秒1000ティック対応
- **シグナル生成頻度**: 毎秒最大10シグナル
- **同時通貨ペア**: 最大5ペア同時監視

### NFR-2.2 信頼性要件
**要件ID**: NFR-2.2  

#### NFR-2.2.1 可用性
- **稼働率**: 99%以上（稼働時間09:00-22:00）
- **データ欠損対応**: 自動補完・代替データ取得
- **通信断対応**: Phase 1フォールバック機構利用

#### NFR-2.2.2 復旧性
- **自動復旧**: プロセス異常時3回まで自動再起動
- **状態復旧**: 異常終了時の状態復旧（5分以内）
- **データ整合性**: 処理中断時のデータ整合性保証

### NFR-2.3 保守性要件
**要件ID**: NFR-2.3  

#### NFR-2.3.1 監視・ログ
- **システム監視**: CPU、メモリ、ネットワーク使用率
- **業務監視**: シグナル生成頻度、精度、遅延
- **ログ出力**: 構造化ログ、エラーレベル分類

#### NFR-2.3.2 設定管理
- **動的設定**: パラメータ変更時の無停止更新
- **設定検証**: 設定変更前の妥当性検証
- **バックアップ**: 設定変更履歴の自動保存

## 🏗️ システムアーキテクチャ概要

### コンポーネント構成
1. **Real-time Data Collector**: MT4価格データ取得
2. **Signal Generator Engine**: ブレイクアウト判定・シグナル生成
3. **WFA Parameter Manager**: 最適パラメータ管理・適用
4. **Quality Assessor**: シグナル品質評価・信頼度算出
5. **Communication Interface**: Phase 1通信インフラとの統合

### データフロー
```
MT4 → Data Collector → Signal Generator → Quality Assessor → Communication Interface → MT4 EA
                    ↑
         WFA Parameter Manager
```

## 🧪 テスト要件

### UT-2.1 単体テスト
- **データ取得**: 価格データ取得機能
- **シグナル生成**: ブレイクアウト判定ロジック
- **品質評価**: 信頼度算出アルゴリズム
- **WFA統合**: パラメータ適用機能

### IT-2.1 統合テスト
- **Phase 1統合**: 通信インフラとの連携
- **WFA統合**: 最適パラメータ適用
- **エンドツーエンド**: データ取得→シグナル生成→MT4送信

### ST-2.1 性能テスト
- **応答時間**: 各処理の応答時間測定
- **負荷テスト**: 高頻度データ処理
- **耐久テスト**: 長時間連続稼働

## 📊 受入基準

### AC-2.1 機能受入基準
- [ ] リアルタイム価格データ取得（<50ms）
- [ ] WFA最適パラメータ適用
- [ ] ブレイクアウトシグナル生成
- [ ] 信頼度評価（0.0-1.0）
- [ ] Phase 1通信インフラ統合
- [ ] エラーハンドリング・復旧機能

### AC-2.2 性能受入基準
- [ ] 価格取得→シグナル生成 <100ms
- [ ] 毎秒1000ティック処理
- [ ] 稼働率99%以上（テスト期間）
- [ ] メモリ使用量<500MB
- [ ] CPU使用率<50%（平均）

### AC-2.3 品質受入基準
- [ ] 単体テスト95%以上パス
- [ ] 統合テスト100%パス
- [ ] コードカバレッジ90%以上
- [ ] ログ出力・監視機能完備
- [ ] 設定管理・バックアップ機能

## 🔒 制約・前提条件

### 制約条件
- **Phase 1依存**: Phase 1通信インフラ完了必須
- **WFA連携**: 既存WFAシステムとの互換性維持
- **MT4環境**: Windows MT4環境での動作
- **WSL2環境**: Python実行環境WSL2
- **稼働時間**: 09:00-22:00（PC自動シャットダウン）

### 前提条件
- Phase 1通信インフラ（TCP・ファイル双方向通信）
- enhanced_parallel_wfa_with_slippage.py（Gemini 5.0/5.0）
- advanced_slippage_model.py
- cron自動化システム
- MT4 EA基盤（BreakoutCommunicationStub.mq4）

## 📈 成功指標

### 技術指標
- **レイテンシ**: <100ms（目標達成）
- **精度**: WFA最適化精度維持
- **安定性**: 99%稼働率達成
- **統合性**: Phase 1との完全統合

### 業務指標
- **シグナル品質**: 信頼度スコア平均0.7以上
- **運用効率**: 自動化率95%以上
- **保守性**: 設定変更の無停止更新
- **監視性**: 完全な状態監視・アラート

## 🚀 次フェーズ移行条件

### Phase 3移行条件
- [ ] Phase 2全受入基準達成
- [ ] 性能要件100%達成
- [ ] 統合テスト100%パス
- [ ] 1週間連続稼働テスト成功
- [ ] Gemini査読合格（A評価以上）

---

**承認**: Phase 2開発開始承認  
**次工程**: Phase 2アーキテクチャ設計  
**責任者**: Claude Code  
**レビュー**: Gemini査読予定