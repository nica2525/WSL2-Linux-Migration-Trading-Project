# Claude Code Hook自動実行問題調査記録

## 📅 調査日時
2025-07-16 07:00-07:15 JST

## 🚨 問題概要
Claude Code Hooksの自動実行が機能しない問題

## 📋 調査結果

### ✅ 確認済み事項
1. **設定ファイル**: `~/.claude/settings.json`で正しく設定
   ```json
   "PostToolUse": [
     {"matcher": ".*", "hooks": [memory_tracker_hook.sh]},
     {"matcher": "mcp__gemini-cli__chat", "hooks": [smart_gpt_rule_loader.sh]}
   ]
   ```

2. **スクリプト権限**: 実行権限付与済み
   - `memory_tracker_hook.sh`: -rwxrwxr-x
   - `smart_gpt_rule_loader.sh`: -rwxr-xr-x

3. **手動実行**: 両スクリプト共に正常動作確認

### ❌ 未解決事項
1. **PostToolUse Hook**: ツール実行後の自動実行なし
   - テスト: `Write`ツール、`Bash`ツール実行
   - 結果: Hook実行されず

2. **Start Hook**: セッション開始時実行の確認不能
   - 現在のセッション中では検証困難

### 🔍 実施したテスト
1. **単純テストスクリプト**: `/tmp/hook_test_simple.sh`作成
2. **設定一時変更**: 単純スクリプトでテスト
3. **結果**: 単純スクリプトでも自動実行されず

## 📊 技術的分析

### 仮説1: matcher問題
- `".*"`パターンが期待通りに動作していない可能性
- tool_name形式が想定と異なる可能性

### 仮説2: Claude Code環境問題  
- Hook機能が無効化されている
- WSL環境固有の問題
- バージョン固有の制約

### 仮説3: 実行タイミング問題
- PostToolUseのトリガー条件が想定と異なる
- ツール実行の定義が不一致

## 🎯 次回必須調査事項

### 1. デバッグモード調査
```bash
claude --debug  # デバッグモードで再起動
/hooks          # 登録Hook確認コマンド
```

### 2. 公式ドキュメント詳細確認
- Hook機能の環境要件
- 既知の制約・問題
- トラブルシューティング手順

### 3. 段階的テスト
1. 最小設定でのテスト
2. 単一Hook設定でのテスト  
3. 絶対パス指定でのテスト

## 📝 重要メモ
- **設定は正しい**: 理論上は動作するはず
- **環境固有問題**: 詳細調査が必要
- **手動実行可能**: スクリプト自体に問題なし

---
**記録者**: Claude (Gemini査読済み)  
**次回継続**: Hook自動実行の根本原因特定・解決